---
title: "C Diff and Math!"
author:
- Jacob Carey
- Sarah Cox
- Katie Goodman
- Alex Pyden
date: "`r format(Sys.time(), '%d %B %Y')`"
bibliography: bibliography.bib
abstract: |
  We propose an extended compartmental model to explore the transmission dynamics of hospital-acquired _C. diff_. 
  Our model will address the shortcomings of @lanzas by explicitly modeling transmission of _C. diff_. via health care workers and via the environment. 
  Additionally, since @lanzas was published, treatment of these infections has significantly advanced and thus we will account for this innovation in our model. 
  Some of the parameters for our model will be estimated from the literature. 
  For these parameters, we will perform a sensitivity analysis to account for the uncertainty. 
  Finally, we numerically solve a system of ordinary differential equations using the R statistical package to estimate the remaining transmission and timing parameters.

output: pdf_document
documentclass: article
header-includes:
- \usepackage{tikz}
- \usetikzlibrary{arrows, automata}
---
\newpage

```{r chunks, echo=FALSE}
knitr::opts_chunk$set(echo=FALSE,
                      message=FALSE)
```

```{r runme, eval=FALSE}
# run this line to create the PDF!
# you might have to change the path 
# i.e. "~/Documents/grad-school-sucks/project.Rmd"
# rmarkdown::render("doc/project.Rmd")
```

```{r libs}
# libraries
library(deSolve)
library(ggplot2)
library(dplyr)
library(tidyr)
theme_set(theme_classic())

# programs
source("../R/model.R")
source("../R/stochasticModel.R")
```

```{r params}
# parameters
a.r <- 0.75
a.s <- 0.22
a.cn <- a.cp <- 0.01
a.d <- 0.01
alpha <- 0.5
theta <- 0.033
beta.c <- beta.d <- 0.007
f <- 0.6
epsilon <- 0.1
e <- 0.01
p <- 0.8
rho <- 0.8
phi <- 0.2
k.r <- 0.33
k <- 0.15
k.d <- 0.068

# sequence of times
max.time <- 2.5e1
times <- seq(0, max.time, 1) 

# delta
delta <- 1e-1
```

```{r old-model}
# parameter vector
param <- c(a.r=a.r, a.s=a.s, a.cn=a.cn, a.cp=a.cp, a.d=a.d, alpha=alpha,
           theta=theta, beta.c=beta.c, beta.d=beta.d, f=f, 
           epsilon=epsilon, p=p, phi=phi, k.r=k.r, k=k, k.d=k.d)

# initial state
initial.state <- c(R=1e3, S=0, P=0, C=1e1, D=0)

model.old <- lsoda(initial.state, times, dx.dt.orig, param, delta=delta)
```

```{r new-model, eval=FALSE}
# parameter vector
param <- c(a.r=a.r, a.s.abx=a.s.abx, a.c=a.c, a.d=a.d, alpha=alpha,
           theta.abx=theta.abx, theta.ft=theta.ft, beta.c=beta.c, beta.d=beta.d,  
           epsilon=epsilon, p=p, phi=phi, k.r=k.r, k=k, k.d=k.d,
           e=e, rho=rho, tau=tau)

# initial state
initial.state <- c(R=1e3, S=0, C=1e1, D=0)

model.new <- lsoda(initial.state, times, dx.dt.new, param, delta=delta)
```

# Introduction
In @lanzas, the authors investigated the transmission dynamics of _Clostridium difficile_ (_C. diff._) using a compartmental model.
_C. diff_ is the leading cause of infectious diarrhea in hospitals and is one of the most common causes of healthcare-acquired infections.
_C. diff_ is a pathogenic bacteria that occasionally replaces the normal bacterial microbiota of a patient’s intestines following clearance by antibiotic treatment, resulting in a diarrheal illness.
The paper highlights the importance of transmission to C. diff. burden in hospital settings, as the authors found that the transmission coefficients associated with colonized and/or symptomatically infected patients were significant drivers of whether $R_0$ was greater or less than 1.
As the model makes some simplifying assumptions about transmission, the authors recommend that future models explicitly incorporate different routes of transmission.
Moreover, with the emergence of fecal transplantation as curative therapy since publication, some of the model’s compartmental assumptions and parameter estimates surrounding treatment may need to be altered.

The expansion of this model has significance to hospital epidemiology policy-setting in health care systems and hospitals globally.
In the United States specifically, _C. diff._ represents a significant ongoing source of healthcare-associated infections, adding at least one billion dollars to the cost of healthcare every year and causing substantial patient morbidity (@stop-c-diff).
Better understanding the dynamics of _C. diff._ transmission within hospital environments is critical to developing appropriate infection control strategies and, in turn, to reducing _C. diff_ burden.

We believe that the expansions proposed in our model are necessary to achieve this objective.
_C. diff._ is relatively unusual among bacterial pathogens, because it has the ability to form spores which are not killed by alcohol-based sanitizers.
Somewhat parodoxically, therefore, although the transition from soap and water to alcohol sanitizers has increased hospital hand hygiene compliance (due to ease of use), it has likely accelerated transmission of _C. diff._ via healthcare workers.
Moreover, since @lanzas was published, the environmental cleaning landscape in hospitals has evolved.
The ongoing Ebola outbreak has heightened infection control awareness, and many hospitals have invested in gas- or UV-based apparatuses that can thoroughly decontaminate patient rooms.
These devices, relative to historical environmental cleaning methods, are more efficacious against _C. diff._ spores.
Consequently, modifying the original model to account for these changes and complexities is critical to accurately modeling the anticipated effects — or unintended consequences — of different infection control policies.

Moreover, since 2011 fecal transplantation to restore endogenous flora has gained increasing acceptance as a curative therapy for _C. diff._
To date, the majority of attention has focused on fecal transplantation’s clinical implications.
However, it also fundamentally alters susceptible and recovery rates relative to conventional antibiotic-based regimens.
These rates are directly relevant to _C. diff._ transmission dynamics but to our knowledge have not been modeled in the literature.

We also read @pelupessy_2002.

# Methods

## Data

## Epidemiological Model

The original model in @lanzas was described by the following system of differential equations.
$$
\begin{aligned}
\frac{dR}{dt}=a_r\delta N + \theta S - k_r R - \alpha R \\
\frac{dS}{dt}=a_s\delta N + \alpha R + p \epsilon D -\theta S - kS-\lambda S \\
\frac{dC^{-}}{dt}=a_{cn}\delta N + (1-f) \lambda S - \psi C^{-} - kC^{-} \\
\frac{dC^{+}}{dt}=a_{cp}\delta N + f\lambda S - kC^{+} \\
\frac{dD}{dt}=a_d\delta N + \psi C^{-} - p\epsilon D - k_dD \\
\lambda=\beta_c(C^{-}+C{+})+\beta_dD \\
N=R+S+C^{-}+C^{+}+D
\end{aligned}
$$
We reran the model, but set delta equal to `r delta` (deterministically).

We modified the @lanzas model and collapsed the colonized compartments into one colonized compartment, and did not distinguish between immune status. We chose to remove this distinction as it seemed somewhat arbitrary. It's not supported in the literature? Reference?

\newpage

We conceptualized our model in this framework. (Note that the parameters aren't final!

\begin{center}
    \begin{tikzpicture}[
        > = stealth, % arrow head style
        auto,
        node distance = 3cm, % distance between nodes
        semithick % line style
        ]

        \tikzstyle{every state}=[
            draw = black,
            thick,
            fill = white,
            minimum size = 4mm
        ]

        \node[state] (R) {Resistant};
        \node[state] (S1) [below left of=R] {Susceptible 1};
        \node[state] (S2) [below right of=R] {Susceptible 2};
        \node[state] (C) [below left of=S2] {Colonized};
        \node[state] (D) [below of=C] {Diseased};

        \path[->] (R) edge node {$\alpha$} (S1);
        \path[->] (R) edge node {$\alpha$} (S2);
        \path[->] (S2) edge node {$\beta$} (R);
        \path[->] (S1) edge node {$\gamma$} (C);
        \path[->] (S2) edge node {$\gamma$} (C);
        \path[->] (C) edge node {$\epsilon$} (D);
        \path[->] (D) edge node {$\theta$} (S1);
        \path[->] (D) edge node {$\theta$} (S2);

    \end{tikzpicture}
\end{center}

$$
\begin{aligned}
\frac{dR}{dt}=a_r\delta N + \theta_a S_a + \theta_f S_f - k_r R - \alpha R \\
\frac{dS_f}{dt}=\alpha R + \rho e D \tau -\theta_f S_f - kS_f-\lambda S_f \\
\frac{dS_a}{dt}=a_s\delta N + \alpha R + p \epsilon D (1 - \tau) -\theta_a S_a - kS_a-\lambda S \\
\frac{dC}{dt}=a_{cn}\delta N + \lambda S_a + \lambda S_f - \psi C- kC \\
\frac{dD}{dt}=a_d\delta N + \psi C - p\epsilon D(1 - \tau) - \rho e D \tau - k_dD \\
\lambda=\beta_cC+\beta_dD \\
N=R+S+C+D
\end{aligned}
$$

## Parameterization

## Next Generation Matrix
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1578275/pdf/rsif20050042.pdf
http://web.stanford.edu/~jhj1/teachingdocs/Jones-on-R0.pdf
http://daphnia.ecology.uga.edu/ceesg/wp-content/uploads/2013/12/nextgen.pdf
http://rsif.royalsocietypublishing.org/content/royinterface/7/47/873.full.pdf

Recommended by Derek
http://www.luchsinger-mathematics.ch/vandenDriessche-R0Compartmental-2002.pdf



# Results
## Comparison of Baseline Differential Equations
```{r graphs-old}
data <- model.old %>% 
    data.frame() %>%
    tbl_df() %>%
    gather(compartment, size, R:D)

ggplot(data, aes(x=time, y=size)) +
    geom_line(aes(colour=compartment, linetype=compartment)) +
    ggtitle("Old Model")
```

```{r graphs-new, eval=FALSE}
data <- model.new %>% 
    data.frame() %>%
    tbl_df() %>%
    gather(compartment, size, R:D)

ggplot(data, aes(x=time, y=size)) +
    geom_line(aes(colour=compartment, linetype=compartment)) +
    ggtitle("Collapsed Colonized Compartments")
```

## Simulation
```{r simulation-lanzas}
simulations <- 1e3

param <- c(a.r=a.r, a.s=a.s, a.cn=a.cn, a.cp=a.cp, a.d=a.d, alpha=alpha,
           theta=theta, beta.c=beta.c, beta.d=beta.d, f=f, 
           epsilon=epsilon, p=p, phi=phi, k.r=k.r, k=k, k.d=k.d)

# initial state
initial.state <- c(R=1e3, S=0, P=0, C=1e1, D=0)

lanzas.attack.rate <- stochastic.sim(param, initial.state,
                                     stochastic.dx.dt)
```

```{r simulation-new}
new.attack.rate <- lanzas.attack.rate
```

We ran `r simulations` and we saw an attack rate of 
`r lanzas.attack.rate[2]` (95% CI `r lanzas.attack.rate[c(1, 3)]`) and
`r new.attack.rate[2]` (95% CI `r new.attack.rate[c(1, 3)]`) in the 
original model and new model respectively.

# Discussion

# References
